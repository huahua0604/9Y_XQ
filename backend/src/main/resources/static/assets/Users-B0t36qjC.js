import{_,r as p,k as j,c as i,a as e,b as x,d as n,v as u,f as C,l as v,m as I,t as c,F as U,p as V,w as B,o as m,n as E}from"./index-L6f31KK7.js";import{h as f}from"./axios-DQV6b0rz.js";function W(r){return f.post("/api/admin/users",r).then(t=>t.data)}function F(){return f.get("/api/admin/users").then(r=>r.data)}function L(r){return f.post(`/api/admin/users/${r}/reset-password`).then(t=>t.data)}function T(r,t){return f.put(`/api/admin/users/${r}`,t).then(b=>b.data)}function z(r){return f.delete(`/api/admin/users/${r}`).then(t=>t.data)}const O={class:"container my-4",style:{"max-width":"1100px"}},q={class:"card shadow-sm mb-3"},G={class:"card-body"},H={class:"row g-3"},J={class:"col-12 col-md-4"},K={class:"col-12 col-md-4"},Q={class:"col-12 col-md-4"},X={class:"col-12 col-md-4"},Y={class:"col-12 col-md-4"},Z={class:"form-check form-check-inline"},ee={class:"form-check form-check-inline"},le={class:"form-check form-check-inline"},se={class:"col-12 col-md-4"},te={key:0,class:"text-success small mt-2"},oe={class:"card shadow-sm"},ae={class:"card-body p-0"},ne={class:"table-responsive"},re={class:"table table-hover table-striped align-middle mb-0"},de={class:"text-body-secondary"},ie={class:"fw-semibold"},me={class:"btn-group btn-group-sm",role:"group"},ue=["onClick"],ce=["onClick"],pe=["onClick"],ve={key:0},be={key:0},fe={class:"modal-dialog modal-lg modal-dialog-centered"},ye={class:"modal-content"},we={class:"modal-body"},ke={class:"row g-3"},ge={class:"col-12 col-md-4"},he={class:"col-12 col-md-4"},xe={class:"col-12 col-md-4"},Ce={class:"col-12"},Ie={class:"form-check form-check-inline"},Ue={class:"form-check form-check-inline"},Ve={class:"form-check form-check-inline"},Ee={class:"col-12 col-md-4"},Pe={__name:"Users",setup(r){const t=p({employeeId:"",name:"",department:"",password:"",roles:["USER"],mustChangePassword:!0}),b=p([]),k=p(""),g=p(!1),h=p(null),a=p({employeeId:"",name:"",department:"",roles:[],mustChangePassword:!0});async function y(){b.value=await F()}function P(o){switch(o){case"ADMIN":return"管理员(主任)";case"REVIEWER":return"审核员(信息科成员)";case"USER":return"普通用户";default:return o}}function R(o){switch(o){case"ADMIN":return"text-bg-danger";case"REVIEWER":return"text-bg-info";case"USER":return"text-bg-secondary";default:return"text-bg-light"}}async function $(){if(!t.value.employeeId?.trim()||!t.value.name?.trim())return alert("请填写工号和姓名");if(t.value.password&&(t.value.password.length<8||t.value.password.length>64))return alert("密码长度需在 8-64 位之间");const o={employeeId:t.value.employeeId.trim(),name:t.value.name.trim(),department:t.value.department?.trim()||void 0,roles:t.value.roles&&t.value.roles.length?t.value.roles:void 0,mustChangePassword:t.value.mustChangePassword,...t.value.password?{password:t.value.password}:{}};try{const s=(await W(o))?.tempPassword;k.value=s||"",alert(s?`创建成功，临时密码：${s}`:"创建成功"),t.value={employeeId:"",name:"",department:"",password:"",roles:["USER"],mustChangePassword:!0},await y()}catch(l){const s=l?.response?.data?.errors;alert(s&&typeof s=="object"?`参数校验失败：
`+Object.entries(s).map(([d,A])=>`${d}: ${A}`).join(`
`):l?.response?.data?.message||"创建失败")}}async function D(o){if(confirm(`确定把 ${o.name}（${o.employeeId}）重置为默认密码？`))try{await L(o.id),alert(`已重置，临时密码：${o.employeeId}${o.employeeId}`)}catch(l){alert(l?.response?.data?.message||"重置失败")}}function M(o){h.value=o.id,a.value={employeeId:o.employeeId,name:o.name,department:o.department,roles:Array.isArray(o.roles)?[...o.roles]:[],mustChangePassword:!!o.mustChangePassword},g.value=!0}function w(){g.value=!1,h.value=null}async function S(){const o=h.value;if(!o)return;const l={employeeId:a.value.employeeId?.trim(),name:a.value.name?.trim(),department:a.value.department?.trim()||"",roles:a.value.roles,mustChangePassword:!!a.value.mustChangePassword};if(!l.employeeId||!l.name)return alert("工号与姓名不能为空");try{await T(o,l),alert("已保存"),w(),await y()}catch(s){alert(s?.response?.data?.message||"保存失败")}}async function N(o){if(confirm(`确定删除用户：${o.name}（${o.employeeId}）？`))try{await z(o.id),await y()}catch(l){alert(l?.response?.data?.message||"删除失败")}}return j(y),(o,l)=>(m(),i("div",O,[l[41]||(l[41]=e("h2",{class:"h4 mb-3"},"用户管理",-1)),e("div",q,[l[26]||(l[26]=e("div",{class:"card-header fw-semibold"},"新增用户",-1)),e("div",G,[e("div",H,[e("div",J,[l[15]||(l[15]=e("label",{class:"form-label"},"工号",-1)),n(e("input",{class:"form-control","onUpdate:modelValue":l[0]||(l[0]=s=>t.value.employeeId=s),placeholder:"如：100001"},null,512),[[u,t.value.employeeId,void 0,{trim:!0}]])]),e("div",K,[l[16]||(l[16]=e("label",{class:"form-label"},"姓名",-1)),n(e("input",{class:"form-control","onUpdate:modelValue":l[1]||(l[1]=s=>t.value.name=s),placeholder:"张三"},null,512),[[u,t.value.name,void 0,{trim:!0}]])]),e("div",Q,[l[17]||(l[17]=e("label",{class:"form-label"},"科室",-1)),n(e("input",{class:"form-control","onUpdate:modelValue":l[2]||(l[2]=s=>t.value.department=s),placeholder:"信息科"},null,512),[[u,t.value.department,void 0,{trim:!0}]])]),e("div",X,[l[18]||(l[18]=e("label",{class:"form-label"},[C("密码 "),e("span",{class:"text-body-secondary"},"(可不填，默认两遍工号)")],-1)),n(e("input",{class:"form-control","onUpdate:modelValue":l[3]||(l[3]=s=>t.value.password=s),type:"password",placeholder:"8-64位"},null,512),[[u,t.value.password,void 0,{trim:!0}]])]),e("div",Y,[l[22]||(l[22]=e("label",{class:"form-label d-block"},"角色",-1)),e("div",Z,[n(e("input",{class:"form-check-input",type:"checkbox",value:"USER","onUpdate:modelValue":l[4]||(l[4]=s=>t.value.roles=s),id:"role-user"},null,512),[[v,t.value.roles]]),l[19]||(l[19]=e("label",{class:"form-check-label",for:"role-user"},"用户",-1))]),e("div",ee,[n(e("input",{class:"form-check-input",type:"checkbox",value:"REVIEWER","onUpdate:modelValue":l[5]||(l[5]=s=>t.value.roles=s),id:"role-reviewer"},null,512),[[v,t.value.roles]]),l[20]||(l[20]=e("label",{class:"form-check-label",for:"role-reviewer"},"审核员(信息科成员)",-1))]),e("div",le,[n(e("input",{class:"form-check-input",type:"checkbox",value:"ADMIN","onUpdate:modelValue":l[6]||(l[6]=s=>t.value.roles=s),id:"role-admin"},null,512),[[v,t.value.roles]]),l[21]||(l[21]=e("label",{class:"form-check-label",for:"role-admin"},"管理员(主任)",-1))])]),e("div",se,[l[24]||(l[24]=e("label",{class:"form-label"},"首登需改密",-1)),n(e("select",{class:"form-select","onUpdate:modelValue":l[7]||(l[7]=s=>t.value.mustChangePassword=s)},[...l[23]||(l[23]=[e("option",{value:!0},"是",-1),e("option",{value:!1},"否",-1)])],512),[[I,t.value.mustChangePassword]])])]),e("div",{class:"d-flex justify-content-end gap-2 mt-3"},[e("button",{class:"btn btn-primary",onClick:$},"创建用户")]),k.value?(m(),i("p",te,[l[25]||(l[25]=C(" 已创建，临时密码：",-1)),e("b",null,c(k.value),1)])):x("",!0)])]),e("div",oe,[l[29]||(l[29]=e("div",{class:"card-header fw-semibold"},"全部用户",-1)),e("div",ae,[e("div",ne,[e("table",re,[l[28]||(l[28]=e("thead",{class:"table-light"},[e("tr",null,[e("th",{style:{width:"70px"}},"ID"),e("th",{style:{width:"140px"}},"工号"),e("th",{style:{width:"140px"}},"姓名"),e("th",{style:{width:"160px"}},"科室"),e("th",null,"角色"),e("th",{style:{width:"120px"}},"首登改密"),e("th",{style:{width:"220px"}},"操作")])],-1)),e("tbody",null,[(m(!0),i(U,null,V(b.value,s=>(m(),i("tr",{key:s.id},[e("td",de,"#"+c(s.id),1),e("td",null,c(s.employeeId),1),e("td",ie,c(s.name),1),e("td",null,c(s.department),1),e("td",null,[(m(!0),i(U,null,V(s.roles,d=>(m(),i("span",{key:d,class:E(["badge me-1",R(d)])},c(P(d)),3))),128))]),e("td",null,[e("span",{class:E(["badge",s.mustChangePassword?"text-bg-warning":"text-bg-secondary"])},c(s.mustChangePassword?"是":"否"),3)]),e("td",null,[e("div",me,[e("button",{class:"btn btn-outline-primary",onClick:d=>D(s)},"重置密码",8,ue),e("button",{class:"btn btn-outline-warning",onClick:d=>M(s)},"修改",8,ce),e("button",{class:"btn btn-outline-danger",onClick:d=>N(s)},"删除",8,pe)])])]))),128)),b.value.length?x("",!0):(m(),i("tr",ve,[...l[27]||(l[27]=[e("td",{colspan:"7",class:"text-center text-body-secondary py-4"},"暂无用户",-1)])]))])])])])]),g.value?(m(),i("div",be,[l[40]||(l[40]=e("div",{class:"modal-backdrop fade show"},null,-1)),e("div",{class:"modal fade show",tabindex:"-1",style:{display:"block"},role:"dialog","aria-modal":"true",onClick:B(w,["self"])},[e("div",fe,[e("div",ye,[e("div",{class:"modal-header"},[l[30]||(l[30]=e("h5",{class:"modal-title"},"修改用户信息",-1)),e("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:w})]),e("div",we,[e("div",ke,[e("div",ge,[l[31]||(l[31]=e("label",{class:"form-label"},"工号",-1)),n(e("input",{class:"form-control","onUpdate:modelValue":l[8]||(l[8]=s=>a.value.employeeId=s)},null,512),[[u,a.value.employeeId,void 0,{trim:!0}]])]),e("div",he,[l[32]||(l[32]=e("label",{class:"form-label"},"姓名",-1)),n(e("input",{class:"form-control","onUpdate:modelValue":l[9]||(l[9]=s=>a.value.name=s)},null,512),[[u,a.value.name,void 0,{trim:!0}]])]),e("div",xe,[l[33]||(l[33]=e("label",{class:"form-label"},"科室",-1)),n(e("input",{class:"form-control","onUpdate:modelValue":l[10]||(l[10]=s=>a.value.department=s)},null,512),[[u,a.value.department,void 0,{trim:!0}]])]),e("div",Ce,[l[37]||(l[37]=e("label",{class:"form-label d-block"},"角色",-1)),e("div",Ie,[n(e("input",{class:"form-check-input",type:"checkbox",value:"USER","onUpdate:modelValue":l[11]||(l[11]=s=>a.value.roles=s),id:"edit-role-user"},null,512),[[v,a.value.roles]]),l[34]||(l[34]=e("label",{class:"form-check-label",for:"edit-role-user"},"用户",-1))]),e("div",Ue,[n(e("input",{class:"form-check-input",type:"checkbox",value:"REVIEWER","onUpdate:modelValue":l[12]||(l[12]=s=>a.value.roles=s),id:"edit-role-reviewer"},null,512),[[v,a.value.roles]]),l[35]||(l[35]=e("label",{class:"form-check-label",for:"edit-role-reviewer"},"审核员(信息科成员)",-1))]),e("div",Ve,[n(e("input",{class:"form-check-input",type:"checkbox",value:"ADMIN","onUpdate:modelValue":l[13]||(l[13]=s=>a.value.roles=s),id:"edit-role-admin"},null,512),[[v,a.value.roles]]),l[36]||(l[36]=e("label",{class:"form-check-label",for:"edit-role-admin"},"管理员(主任)",-1))])]),e("div",Ee,[l[39]||(l[39]=e("label",{class:"form-label"},"首登需改密",-1)),n(e("select",{class:"form-select","onUpdate:modelValue":l[14]||(l[14]=s=>a.value.mustChangePassword=s)},[...l[38]||(l[38]=[e("option",{value:!0},"是",-1),e("option",{value:!1},"否",-1)])],512),[[I,a.value.mustChangePassword]])])])]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-outline-secondary",onClick:w},"取消"),e("button",{class:"btn btn-primary",onClick:S},"保存")])])])])])):x("",!0)]))}},De=_(Pe,[["__scopeId","data-v-ad5ec35f"]]);export{De as default};
