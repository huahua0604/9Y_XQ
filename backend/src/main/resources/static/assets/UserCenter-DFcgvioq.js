import{r as n,u as I,k as x,c as f,a as e,d as r,v as p,t as v,e as y,o as _}from"./index-BCFNTfTT.js";import{h as c}from"./axios-CP6D1eTq.js";const U={key:0,class:"container my-4"},V={class:"card shadow-sm mb-4"},C={class:"card-body"},M={class:"row g-3"},B={class:"col-md-4"},D={class:"col-md-4"},N={class:"col-md-4"},S={class:"mt-3"},$=["disabled"],A={id:"password",class:"card shadow-sm"},E={class:"card-body"},L={class:"row g-3"},O={class:"col-md-4"},R={class:"input-group"},T=["type"],j=["title","aria-label"],q={class:"col-md-4"},z={class:"input-group"},F=["type"],G=["title","aria-label"],H={class:"mt-3"},J=["disabled"],K={key:1,class:"container my-5"},Y={__name:"UserCenter",setup(Q){const d=n(!1),i=n(!1),g=I(),w=n(!1),t=n({employeeId:"",name:"",department:""}),u=n(!1),o=n({oldPassword:"",newPassword:""}),m=n(!1);async function P(){const{data:l}=await c.get("/api/me");t.value={employeeId:l.employeeId||"",name:l.name||"",department:l.department||""},w.value=!0}x(P);function b(l="信息已更新，请重新登录"){g.logout(),alert(l),window.location.replace("/login")}async function h(){if(t.value)try{u.value=!0,await c.put("/api/me",{employeeId:t.value.employeeId?.trim(),name:t.value.name?.trim(),department:t.value.department?.trim()}),b("信息已更新，请重新登录后生效")}catch(l){alert(l?.response?.data?.message||"保存失败")}finally{u.value=!1}}async function k(){if(!o.value.oldPassword||!o.value.newPassword){alert("请填写完整");return}try{m.value=!0,await c.put("/api/me/password",{oldPassword:o.value.oldPassword,newPassword:o.value.newPassword}),b("密码已修改，请重新登录")}catch(l){alert(l?.response?.data?.message||"修改失败")}finally{m.value=!1}}return(l,s)=>w.value?(_(),f("div",U,[s[14]||(s[14]=e("h3",{class:"mb-3"},"用户中心",-1)),e("div",V,[s[10]||(s[10]=e("div",{class:"card-header fw-semibold"},"基础信息",-1)),e("div",C,[e("div",M,[e("div",B,[s[7]||(s[7]=e("label",{class:"form-label"},"工号",-1)),r(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>t.value.employeeId=a),class:"form-control",maxlength:"32"},null,512),[[p,t.value.employeeId,void 0,{trim:!0}]])]),e("div",D,[s[8]||(s[8]=e("label",{class:"form-label"},"姓名",-1)),r(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>t.value.name=a),class:"form-control",maxlength:"50"},null,512),[[p,t.value.name,void 0,{trim:!0}]])]),e("div",N,[s[9]||(s[9]=e("label",{class:"form-label"},"科室",-1)),r(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>t.value.department=a),class:"form-control",maxlength:"50"},null,512),[[p,t.value.department,void 0,{trim:!0}]])])]),e("div",S,[e("button",{class:"btn btn-primary",disabled:u.value,onClick:h},v(u.value?"保存中...":"保存"),9,$)])])]),e("div",A,[s[13]||(s[13]=e("div",{class:"card-header fw-semibold"},"修改密码",-1)),e("div",E,[e("div",L,[e("div",O,[s[11]||(s[11]=e("label",{class:"form-label"},"原密码",-1)),e("div",R,[r(e("input",{type:d.value?"text":"password","onUpdate:modelValue":s[3]||(s[3]=a=>o.value.oldPassword=a),class:"form-control",autocomplete:"current-password"},null,8,T),[[y,o.value.oldPassword]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[4]||(s[4]=a=>d.value=!d.value),title:d.value?"隐藏":"显示","aria-label":d.value?"隐藏密码":"显示密码"},v(d.value?"隐藏":"显示"),9,j)])]),e("div",q,[s[12]||(s[12]=e("label",{class:"form-label"},"新密码（8-64位）",-1)),e("div",z,[r(e("input",{type:i.value?"text":"password","onUpdate:modelValue":s[5]||(s[5]=a=>o.value.newPassword=a),class:"form-control",autocomplete:"new-password"},null,8,F),[[y,o.value.newPassword]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:s[6]||(s[6]=a=>i.value=!i.value),title:i.value?"隐藏":"显示","aria-label":i.value?"隐藏密码":"显示密码"},v(i.value?"隐藏":"显示"),9,G)])])]),e("div",H,[e("button",{class:"btn btn-primary",disabled:m.value,onClick:k},v(m.value?"提交中...":"修改密码"),9,J)])])])])):(_(),f("div",K," 正在加载... "))}};export{Y as default};
