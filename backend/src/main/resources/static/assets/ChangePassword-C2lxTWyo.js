import{_ as B,u as S,r as l,i as m,c as b,a as s,b as y,t as c,w as z,d as h,e as g,n as _,j as M,f as N,h as $,o as f}from"./index-zVoxIsoq.js";import{h as q}from"./axios-3glaY4tD.js";const A={class:"container my-5"},D={class:"card shadow-sm mx-auto",style:{"max-width":"520px"}},L={class:"card-body"},U={key:0,class:"alert alert-danger py-2",role:"alert"},Z={class:"mb-3"},j={class:"input-group"},E=["type"],I={class:"mb-2"},O={class:"input-group"},R=["type"],T={class:"mb-3"},F={class:"progress",style:{height:"6px"}},G=["aria-valuenow"],H={class:"text-body-secondary"},J=["disabled"],K={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Q={__name:"ChangePassword",setup(W){const x=$(),k=S(),n=l(""),o=l(""),r=l(!1),i=l(""),u=l(!1),d=l(!1),v=l({old:!1,new:!1}),w=m(()=>(o.value||"").length>=8),C=m(()=>!!n.value&&w.value),p=m(()=>{const t=o.value||"";let e=0;return t.length>=8&&(e+=30),/[0-9]/.test(t)&&(e+=20),/[a-z]/.test(t)&&/[A-Z]/.test(t)&&(e+=30),/[^A-Za-z0-9]/.test(t)&&(e+=20),Math.min(e,100)}),P=m(()=>o.value?p.value<40?"弱":p.value<70?"中":"强":"无");async function V(){i.value="",r.value=!0;try{await q.post("/api/auth/change-password",{oldPassword:n.value,newPassword:o.value}),alert("密码已修改，请使用新密码重新登录"),k.clear(),x.replace({name:"login",query:{from:"pwd"}})}catch(t){i.value=t?.response?.data?.message||"修改失败，请稍后重试"}finally{r.value=!1}}return(t,e)=>(f(),b("div",A,[s("div",D,[s("div",L,[e[12]||(e[12]=s("h2",{class:"h5 mb-3"},"首次登录需修改密码",-1)),i.value?(f(),b("div",U,c(i.value),1)):y("",!0),s("form",{onSubmit:z(V,["prevent"]),class:"needs-validation",novalidate:""},[s("div",Z,[e[7]||(e[7]=s("label",{class:"form-label"},"原密码",-1)),s("div",j,[h(s("input",{type:u.value?"text":"password",class:_(["form-control",{"is-invalid":v.value.old&&!n.value}]),"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),required:"",onBlur:e[1]||(e[1]=a=>v.value.old=!0)},null,42,E),[[g,n.value,void 0,{trim:!0}]]),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=a=>u.value=!u.value)},c(u.value?"隐藏":"显示"),1),e[6]||(e[6]=s("div",{class:"invalid-feedback"},"请输入原密码。",-1))])]),s("div",I,[e[9]||(e[9]=s("label",{class:"form-label"},"新密码",-1)),s("div",O,[h(s("input",{type:d.value?"text":"password",class:_(["form-control",{"is-invalid":v.value.new&&!w.value}]),placeholder:"密码长度需大于8位","onUpdate:modelValue":e[3]||(e[3]=a=>o.value=a),minlength:"8",required:"",onBlur:e[4]||(e[4]=a=>v.value.new=!0)},null,42,R),[[g,o.value,void 0,{trim:!0}]]),s("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[5]||(e[5]=a=>d.value=!d.value)},c(d.value?"隐藏":"显示"),1),e[8]||(e[8]=s("div",{class:"invalid-feedback"},"至少 8 位新密码。",-1))]),e[10]||(e[10]=s("div",{class:"form-text"},"建议包含大小写字母与数字，避免与旧密码相似。",-1))]),s("div",T,[s("div",F,[s("div",{class:"progress-bar",role:"progressbar",style:M({width:p.value+"%"}),"aria-valuenow":p.value,"aria-valuemin":"0","aria-valuemax":"100"},null,12,G)]),s("small",H,"密码强度："+c(P.value),1)]),s("button",{class:"btn btn-primary w-100",type:"submit",disabled:r.value||!C.value},[r.value?(f(),b("span",K)):y("",!0),e[11]||(e[11]=N(" 保存 ",-1))],8,J)],32)])])]))}},ee=B(Q,[["__scopeId","data-v-b4e10faf"]]);export{ee as default};
