import{u as P,r as d,k as I,c as p,a as s,d as n,v as r,t as w,o as f}from"./index-C6sVj0mo.js";import{h as u}from"./axios-jrpWzxwM.js";const h={key:0,class:"container my-4"},k={class:"card shadow-sm mb-4"},x={class:"card-body"},U={class:"row g-3"},V={class:"col-md-4"},B={class:"col-md-4"},C={class:"col-md-4"},M={class:"mt-3"},D=["disabled"],S={id:"password",class:"card shadow-sm"},A={class:"card-body"},E={class:"row g-3"},L={class:"col-md-4"},N={class:"col-md-4"},R={class:"mt-3"},T=["disabled"],j={key:1,class:"container my-5"},G={__name:"UserCenter",setup(q){const b=P(),v=d(!1),a=d({employeeId:"",name:"",department:""}),i=d(!1),t=d({oldPassword:"",newPassword:""}),m=d(!1);async function y(){const{data:o}=await u.get("/api/me");a.value={employeeId:o.employeeId||"",name:o.name||"",department:o.department||""},v.value=!0}I(y);function c(o="信息已更新，请重新登录"){b.logout(),alert(o),window.location.replace("/login")}async function _(){if(a.value)try{i.value=!0,await u.put("/api/me",{employeeId:a.value.employeeId?.trim(),name:a.value.name?.trim(),department:a.value.department?.trim()}),c("信息已更新，请重新登录后生效")}catch(o){alert(o?.response?.data?.message||"保存失败")}finally{i.value=!1}}async function g(){if(!t.value.oldPassword||!t.value.newPassword){alert("请填写完整");return}try{m.value=!0,await u.put("/api/me/password",{oldPassword:t.value.oldPassword,newPassword:t.value.newPassword}),c("密码已修改，请重新登录")}catch(o){alert(o?.response?.data?.message||"修改失败")}finally{m.value=!1}}return(o,e)=>v.value?(f(),p("div",h,[e[12]||(e[12]=s("h3",{class:"mb-3"},"用户中心",-1)),s("div",k,[e[8]||(e[8]=s("div",{class:"card-header fw-semibold"},"基础信息",-1)),s("div",x,[s("div",U,[s("div",V,[e[5]||(e[5]=s("label",{class:"form-label"},"工号",-1)),n(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.employeeId=l),class:"form-control",maxlength:"32"},null,512),[[r,a.value.employeeId,void 0,{trim:!0}]])]),s("div",B,[e[6]||(e[6]=s("label",{class:"form-label"},"姓名",-1)),n(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.name=l),class:"form-control",maxlength:"50"},null,512),[[r,a.value.name,void 0,{trim:!0}]])]),s("div",C,[e[7]||(e[7]=s("label",{class:"form-label"},"科室",-1)),n(s("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.department=l),class:"form-control",maxlength:"50"},null,512),[[r,a.value.department,void 0,{trim:!0}]])])]),s("div",M,[s("button",{class:"btn btn-primary",disabled:i.value,onClick:_},w(i.value?"保存中...":"保存"),9,D)])])]),s("div",S,[e[11]||(e[11]=s("div",{class:"card-header fw-semibold"},"修改密码",-1)),s("div",A,[s("div",E,[s("div",L,[e[9]||(e[9]=s("label",{class:"form-label"},"原密码",-1)),n(s("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.oldPassword=l),type:"password",class:"form-control"},null,512),[[r,t.value.oldPassword]])]),s("div",N,[e[10]||(e[10]=s("label",{class:"form-label"},"新密码（8-64位）",-1)),n(s("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.newPassword=l),type:"password",class:"form-control"},null,512),[[r,t.value.newPassword]])])]),s("div",R,[s("button",{class:"btn btn-outline-secondary",disabled:m.value,onClick:g},w(m.value?"提交中...":"修改密码"),9,T)])])])])):(f(),p("div",j," 正在加载... "))}};export{G as default};
