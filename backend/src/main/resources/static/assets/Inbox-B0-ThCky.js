import{_ as h,u as V,r as u,i as v,k as M,c as i,a as t,d as R,v as k,n as p,m as N,A as P,b as _,F as B,p as S,t as o,h as O,o as r}from"./index-D-qiAXzM.js";import{a as U}from"./demand-DI9nt4ux.js";import"./axios-OzzXNU6D.js";const F={class:"container"},L={class:"hdr"},W={class:"actions"},J=["disabled"],$={class:"tabs"},q={class:"d-flex align-items-center gap-2"},z={class:"tbl"},j=["onClick"],G=["onClick"],H={key:0},K={key:1},Q={__name:"Inbox",setup(X){const y=O(),E=V(),m=u([]),l=u(!1),n=u("todo"),d=u(""),c=u(""),I=v(()=>(E.roles||[]).includes("ADMIN")),C=v(()=>(E.roles||[]).includes("REVIEWER"));function T(a){const e=I.value&&a.status==="SUBMITTED",s=C.value&&a.status==="ADMIN_APPROVED";return e||s}const D=v(()=>{let a=[...m.value];if(n.value==="todo"&&(a=a.filter(T)),d.value&&(a=a.filter(e=>e.status===d.value)),c.value){const e=c.value.toLowerCase();a=a.filter(s=>(s.title||"").toLowerCase().includes(e)||(s.createdByName||"").toLowerCase().includes(e))}return a});function g(a){return a?String(a).replace("T"," ").slice(0,19):""}function f(a){y.push(`/demands/${a.id}`)}function x(a){switch(a){case"DRAFT":return"草稿";case"SUBMITTED":return"待主任审批";case"ADMIN_APPROVED":return"主任同意";case"ADMIN_REJECTED":return"主任驳回";case"REVIEW_APPROVED":return"科室同意";case"REVIEW_REJECTED":return"科室驳回";case"COMPLETED":return"已完成";default:return a||"未知"}}function A(a){switch((a||"").toUpperCase()){case"DRAFT":return"text-bg-secondary";case"SUBMITTED":return"text-bg-info";case"IN_REVIEW":return"text-bg-primary";case"RETURNED":return"text-bg-warning";case"REJECTED":return"text-bg-danger";case"APPROVED":case"DONE":return"text-bg-success";default:return"text-bg-secondary"}}async function b(){l.value=!0;try{m.value=await U()}finally{l.value=!1}}return M(b),(a,e)=>(r(),i("div",F,[t("div",L,[e[4]||(e[4]=t("h2",null,"审批收件箱",-1)),t("div",W,[R(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),placeholder:"按标题/提交人搜索…"},null,512),[[k,c.value,void 0,{trim:!0}]]),t("button",{onClick:b,disabled:l.value},"刷新",8,J)])]),t("div",$,[t("button",{class:p({on:n.value==="todo"}),onClick:e[1]||(e[1]=s=>n.value="todo")},"待我审批",2),t("button",{class:p({on:n.value==="all"}),onClick:e[2]||(e[2]=s=>n.value="all")},"全部",2),t("div",q,[e[6]||(e[6]=t("label",{class:"form-label mb-0"},"状态：",-1)),R(t("select",{class:"form-select form-select-sm w-auto","onUpdate:modelValue":e[3]||(e[3]=s=>d.value=s)},[...e[5]||(e[5]=[P('<option value="" data-v-89a4c675>全部</option><option value="SUBMITTED" data-v-89a4c675>待主任审批</option><option value="ADMIN_APPROVED" data-v-89a4c675>待科室审批</option><option value="ADMIN_REJECTED" data-v-89a4c675>主任驳回</option><option value="REVIEW_APPROVED" data-v-89a4c675>科室通过</option><option value="REVIEW_REJECTED" data-v-89a4c675>科室驳回</option><option value="COMPLETED" data-v-89a4c675>已完成</option>',7)])],512),[[N,d.value]])])]),t("table",z,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",{style:{width:"80px"}},"ID"),t("th",null,"标题"),t("th",{style:{width:"110px"}},"申请类型"),t("th",{style:{width:"140px"}},"状态"),t("th",null,"提交人"),t("th",{style:{width:"170px"}},"时间"),t("th",{style:{width:"90px"}},"操作")])],-1)),t("tbody",null,[(r(!0),i(B,null,S(D.value,s=>(r(),i("tr",{key:s.id},[t("td",null,o(s.id),1),t("td",{class:"title",onClick:w=>f(s)},o(s.title),9,j),t("td",null,o(s.category),1),t("td",null,[t("span",{class:p(["badge",A(s.status)])},o(x(s.status)),3)]),t("td",null,o(s.createdByName)+"（"+o(s.createdByDept)+"）",1),t("td",null,o(g(s.submittedAt||s.createdAt)),1),t("td",null,[t("button",{class:"small",onClick:w=>f(s)},"查看",8,G)])]))),128)),!l.value&&D.value.length===0?(r(),i("tr",H,[...e[7]||(e[7]=[t("td",{colspan:"8",class:"empty"},"暂无数据",-1)])])):_("",!0),l.value?(r(),i("tr",K,[...e[8]||(e[8]=[t("td",{colspan:"8",class:"empty"},"加载中…",-1)])])):_("",!0)])])]))}},et=h(Q,[["__scopeId","data-v-89a4c675"]]);export{et as default};
