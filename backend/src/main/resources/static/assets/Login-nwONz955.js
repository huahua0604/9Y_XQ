import{_,u as g,r,c as u,a as t,b as y,t as b,w,d as h,v as x,e as k,f as A,g as C,h as I,o as c}from"./index-K_qyC4St.js";import{h as V}from"./axios-DDDGdvtu.js";const q={class:"container my-5"},M={class:"card shadow-sm mx-auto",style:{"max-width":"420px"}},P={class:"card-body"},S={key:0,class:"alert alert-danger py-2",role:"alert"},B={class:"mb-3"},D={class:"mb-3"},L={class:"input-group"},N=["type"],U=["disabled"],R={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},T={__name:"Login",setup(E){const p=C(),m=I(),v=g(),o=r(""),l=r(""),n=r(!1),d=r(""),i=r(!1);async function f(){d.value="",n.value=!0;try{const{data:s}=await V.post("/api/auth/login",{employeeId:o.value,password:l.value}),e=s.user||{employeeId:s.employeeId??o.value,name:s.name??"",department:s.department??"",roles:Array.isArray(s.roles)?s.roles:Array.isArray(s.authorities)?s.authorities:[]};if(v.setAuth(s.token,e,{mustChangePassword:!!s.mustChangePassword}),v.mustChangePassword)m.replace("/change-password");else{const a=p.query.redirect?String(p.query.redirect):"/my";m.replace(a)}}catch(s){d.value=s?.response?.data?.message||s?.message||"登录失败，请重试"}finally{n.value=!1}}return(s,e)=>(c(),u("div",q,[t("div",M,[t("div",P,[e[6]||(e[6]=t("h1",{class:"h5 mb-3"},"登录",-1)),d.value?(c(),u("div",S,b(d.value),1)):y("",!0),t("form",{onSubmit:w(f,["prevent"]),novalidate:""},[t("div",B,[e[3]||(e[3]=t("label",{class:"form-label"},"工号",-1)),h(t("input",{class:"form-control","onUpdate:modelValue":e[0]||(e[0]=a=>o.value=a),required:"",autofocus:"",placeholder:"请输入工号"},null,512),[[x,o.value,void 0,{trim:!0}]])]),t("div",D,[e[4]||(e[4]=t("label",{class:"form-label"},"密码",-1)),t("div",L,[h(t("input",{type:i.value?"text":"password",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=a=>l.value=a),required:"",placeholder:"请输入密码"},null,8,N),[[k,l.value]]),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=a=>i.value=!i.value)},b(i.value?"隐藏":"显示"),1)])]),t("button",{type:"submit",class:"btn btn-primary w-100",disabled:n.value||!o.value||!l.value},[n.value?(c(),u("span",R)):y("",!0),e[5]||(e[5]=A(" 登录 ",-1))],8,U)],32)])])]))}},z=_(T,[["__scopeId","data-v-840ccd71"]]);export{z as default};
